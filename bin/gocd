#!/usr/bin/env python
# -*- encoding: utf-8 -*-
from __future__ import unicode_literals, print_function

import os.path
import sys

from gocd_cli.utils import get_command, list_commands, get_command_module, dasherize_name, get_go_server


def usage():
    print('usage: {0} <command> <subcommand> [<posarg1>, ...] [--kwarg1=value, ...]'.format(
        os.path.basename(sys.argv[0])
    ))
    print('Commands:')
    for command in list_commands():
        print('{0:3}{1}'.format('', command))
        module = get_command_module(command)
        for subcommand in module.__all__:
            cmd = getattr(module, subcommand)
            print('{0:7}{1}: {2}'.format('', dasherize_name(subcommand), cmd.get_usage_summary()))


if __name__ == '__main__':
    if len(sys.argv) < 3:
        usage()
        sys.exit(1)
    else:
        command, subcommand = sys.argv[1:3]
        server = get_go_server()
        get_command(server, *sys.argv[1:]).run()
